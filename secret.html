<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>only you</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="style.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600&display=swap');

body{
  font-family:'Playfair Display',serif;
  background:linear-gradient(135deg,#fcfadd,#f3efd0);
  color:#3b2200;
  height:100vh;
  margin:0;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}

.card{
  width:520px;
  max-width:90vw;
  text-align:center;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:12px;
  z-index:3;
	transform: translateZ(0);
}

h1{
  margin:0;
  font-weight:600;
  letter-spacing:.5px;
}

.main-text{
  min-height:96px;
  max-width:420px;
  font-size:22px;
  line-height:1.5;
  text-align:center;
}

.text-wrap{
  position:relative;
  height:72px;
  width:100%;
}

.line{
  position:absolute;
  left:0;
  right:0;
  top:0;
  margin:auto;
  font-size:17px;
  line-height:1.6;
  opacity:0;
  transform:translateY(8px);
  transition:all 1.2s ease;
}

.line.show{
  opacity:1;
  transform:translateY(0);
}

.sticker-main{
  width:120px;
	height:120px;
  cursor:pointer;
  transition:.25s;
}

.sticker-main:hover{
  transform:scale(1.05);
}

#stickerField{
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index:1;
}

.random-sticker{
  position: absolute;
  width: 80px;
  opacity: 0;
  transform: scale(0.6);
  transition: opacity .4s ease, transform .4s ease;
  animation: floaty 4s ease-in-out infinite;
  will-change: transform;
  pointer-events: auto;
  cursor: pointer;
}

@keyframes floaty{
  0%{ transform: translate(0,0) scale(1); }
  50%{ transform: translate(6px,-14px) scale(1.05); }
  100%{ transform: translate(0,0) scale(1); }
}

.confetti{
  position: absolute;
  width: 6px;
  height: 6px;
  border-radius: 2px;
  pointer-events: none;
  animation: confetti-burst 700ms ease-out forwards;
}

@keyframes confetti-burst{
  0%{
    transform: translate(0,0) scale(1) rotate(0deg);
    opacity: 1;
  }
  100%{
    transform: translate(var(--x), var(--y)) scale(0.6) rotate(360deg);
    opacity: 0;
  }
}

.piece{
  position: fixed;
  width: 36px;
  pointer-events: none;
  animation: piece-burst 900ms ease-out forwards;
}

@keyframes piece-burst{
  0%{
    transform: translate(0,0) scale(1) rotate(0deg);
    opacity: 1;
  }
  100%{
    transform: translate(var(--x), var(--y)) scale(.7) rotate(540deg);
    opacity: 0;
  }
}
</style>
</head>

<body>
<audio id="bgMusic" src="music.mp3" preload="auto"></audio>
<div class="card">
  <h1>So it begins.</h1>

  <div class="text-wrap">
    <p class="line" id="line2"></p>
  </div>

  <img
    src="sticker-main-removebg.png"
    class="sticker-main"
    id="mainSticker"
    onclick="remember()"
  />
</div>

<div id="stickerField"></div>

<script>
let done=false;

function remember(){
  if(done) return;
  done=true;

	const music = document.getElementById("bgMusic");
	music.currentTime = 0;
	music.play().catch(()=>{});

  const today=new Date().toDateString();
  const line2=document.getElementById("line2");

  line2.innerHTML =
    "We can always look back and say - it started on " + today;

  setTimeout(()=>line2.classList.add("show"),50);

  const mainSticker=document.getElementById("mainSticker");
	burstIntoStickers(mainSticker);
  mainSticker.style.opacity=0;
	mainSticker.style.visibility="hidden";
	mainSticker.style.pointerEvents="none";
  setTimeout(()=>mainSticker.style.display="none",300);

  spawnStickers();
}

/* CONFETTI */
function explodeConfetti(x,y,parent){
  const colors=["#ff6b6b","#feca57","#48dbfb","#1dd1a1","#5f27cd"];

  for(let i=0;i<14;i++){
    const c=document.createElement("div");
    c.className="confetti";

    const angle=Math.random()*Math.PI*2;
    const dist=Math.random()*40+10;

    c.style.left=x+"px";
    c.style.top=y+"px";
    c.style.background=colors[Math.floor(Math.random()*colors.length)];
    c.style.setProperty("--x",Math.cos(angle)*dist+"px");
    c.style.setProperty("--y",Math.sin(angle)*dist+"px");

    parent.appendChild(c);
    setTimeout(()=>c.remove(),700);
  }
}

function burstIntoStickers(sourceEl){
  const rect = sourceEl.getBoundingClientRect();

  const miniStickers = [
    "sticker1-removebg.png",
    "sticker2-removebg.png",
    "sticker3-removebg.png",
    "sticker4-removebg.png",
    "sticker5-removebg.png",
    "sticker6-removebg.png",
    "sticker7-removebg.png",
    "sticker8-removebg.png",
    "sticker9-removebg.png",
    "sticker10-removebg.png"
  ];

  for(let i=0;i<10;i++){
    const p = document.createElement("img");
    p.className = "piece";
    p.src = miniStickers[Math.floor(Math.random()*miniStickers.length)];

    const cx = rect.left + rect.width/2;
    const cy = rect.top + rect.height/2;

    p.style.left = cx + "px";
    p.style.top = cy + "px";

    const angle = Math.random()*Math.PI*2;
    const dist = Math.random()*120 + 40;

    p.style.setProperty("--x", Math.cos(angle)*dist+"px");
    p.style.setProperty("--y", Math.sin(angle)*dist+"px");

    document.body.appendChild(p);

    setTimeout(()=>p.remove(),900);
  }
}

function spawnStickers(){
  const field=document.getElementById("stickerField");

  /* FIX: danh sách KHÔNG trùng */
  const stickers=[
    "sticker1-removebg.png",
    "sticker2-removebg.png",
    "sticker3-removebg.png",
    "sticker4-removebg.png",
    "sticker5-removebg.png",
    "sticker6-removebg.png",
    "sticker7-removebg.png",
    "sticker8-removebg.png",
    "sticker9-removebg.png",
    "sticker10-removebg.png",
    "sticker-main-removebg.png"
  ];

  /* FIX: shuffle + lấy 10 */
  const selected=[...stickers]
    .sort(()=>Math.random()-0.5)
    .slice(0,10);

  const placedPositions=[];

  function isTooClose(x,y){
    const minDistance=12;
    return placedPositions.some(p=>{
      const dx=p.x-x;
      const dy=p.y-y;
      return Math.sqrt(dx*dx+dy*dy)<minDistance;
    });
  }

  for(let i=0;i<selected.length;i++){
    const img=document.createElement("img");
    img.src=selected[i];
    img.className="random-sticker";
    img.style.animationDelay=(Math.random()*2)+"s";

    let x,y,tries=0;
    do{
      x=Math.random()*80+5;
      y=Math.random()*80+5;
      tries++;
    }while(isTooClose(x,y)&&tries<50);

    placedPositions.push({x,y});

    img.style.left=x+"%";
    img.style.top=y+"%";

    field.appendChild(img);

    img.addEventListener("click",(e)=>{
      const rect=img.getBoundingClientRect();
      explodeConfetti(
        rect.left+rect.width/2,
        rect.top+rect.height/2,
        field
      );

      img.style.transform="scale(1.15)";
      setTimeout(()=>img.style.transform="scale(1)",150);
    });

    setTimeout(()=>{
      img.style.opacity=1;
      img.style.transform="scale(1)";
    },i*180);
  }
}
</script>

</body>
</html>


